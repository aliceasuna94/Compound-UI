<!doctype html><html lang="en">
<!-- Mirrored from compound.finance/docs/comptroller by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Nov 2020 22:06:21 GMT -->
<head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width,height=device-height"><meta property="og:title" content="Compound | Docs - Comptroller"><meta property="og:description" content="Compound is an algorithmic, autonomous interest rate protocol built for developers, to unlock a universe of open financial applications."><meta property="og:image" content="../images/meta-tag.png"><meta property="og:url" content="../index.html"><meta name="twitter:card" content="summary_large_image"><link rel="apple-touch-icon" sizes="192x192" href="../images/compound-192.png"><link rel="apple-touch-icon" sizes="512x512" href="../images/compound-512.png"><link rel="manifest" href="../manifest.json"><link rel="shortcut icon" href="../favicon.ico"><title>Compound | Docs - Comptroller</title><meta name="description" content="Compound is an algorithmic, autonomous interest rate protocol built for developers, to unlock a universe of open financial applications."><link href="../static/css/landing.dc072784.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app. Compound is a web application. This app requires JavaScript to run.</noscript><div id="main"><header id="header" class="landing  light"><div class="container-large"><div class="row align-middle"><div class="col-sm-3 col-xs-10 logo"><a href="../index.html" class="brand"></a></div><div class="mobile-hide col-xs-6 text-center links"><a class="" href="../markets.html">Markets</a><a class="" href="../governance.html">Governance</a><a class="" href="../developers.html">Developers</a><a class="" href="../prices.html">Prices</a><a class="active" href="../docs.html">Docs</a></div><div class="mobile-hide col-xs-3 text-right"><a class="dapp button hollow" rel="external" href="../../app.compound.finance/index.html">App</a></div><div class="mobile-only col-xs-2 hamburger "><span></span><span></span><span></span></div></div></div><div class="mobile-header   light"><div class="links"><ul><a href="../index.html"><li><p>Home</p></li></a><a href="../markets.html"><li><p>Markets</p></li></a><a href="../governance.html"><li><p>Governance</p></li></a><a href="../developers.html"><li><p>Developers</p></li></a><a href="../prices.html"><li><p>Prices</p></li></a><a href="../docs.html"><li><p>Docs</p></li></a></ul></div><a class="dapp button hollow" rel="external" href="../../app.compound.finance/index.html">App</a></div></header><div class="documentation" id="documentation"><span></span><div id="docs-navigation" class="docs-navigation"><div class="container-large docs-navigation__content"><a class="mobile-hide" href="../docs.html">Getting Started</a><a class="mobile-hide" href="ctokens.html">cTokens</a><a class="mobile-hide active" href="comptroller.html">Comptroller</a><a class="mobile-hide" href="governance.html">Governance</a><a class="mobile-hide" href="prices.html">Open Price Feed</a><a class="mobile-hide" href="api.html">API</a><a class="mobile-hide" href="compound-js.html">Compound.js</a><a class="" href="security.html">Security</a><div class="chevron-container"><div class="chevron"></div></div></div><div class="docs-navigation__content--mobile"><a class="" href="../docs.html">Getting Started</a><a class="" href="ctokens.html">cTokens</a><a class=" active" href="comptroller.html">Comptroller</a><a class="" href="governance.html">Governance</a><a class="" href="prices.html">Open Price Feed</a><a class="" href="api.html">API</a><a class="" href="compound-js.html">Compound.js</a><a class="" href="security.html">Security</a></div></div><div class="docs container-large"><div class="row"><div class="side-navigation col-sm-3"><div id="docs-side-navigation" class="side-navigation__content"><a class="section" href="#introduction">Introduction</a><a class="section" href="#architecture">Architecture</a><a class="section" href="#enter-markets">Enter Markets</a><a class="section" href="#exit-market">Exit Market</a><a class="section" href="#get-assets-in">Get Assets In</a><a class="section" href="#collateral-factor">Collateral Factor</a><a class="section" href="#account-liquidity">Get Account Liquidity</a><a class="section" href="#close-factor">Close Factor</a><a class="section" href="#liquidation-incentive">Liquidation Incentive</a><a class="section" href="#key-events">Key Events</a><a class="section" href="#error-codes">Error Codes</a><a class="section" href="#refresh-comp-speeds">COMP Distribution Speeds</a><a class="section" href="#claim-comp">Claim COMP</a><a class="section" href="#market-metadata">Market Metadata</a></div></div><div class="col-xs-12 col-sm-9 content"><section id="introduction"><label class="big">Comptroller</label><h2 class="subheader">Introduction</h2><p>The Comptroller is the risk management layer of the Compound protocol; it determines how much collateral a user is required to maintain, and whether (and by how much) a user can be liquidated. Each time a user interacts with a cToken, the Comptroller is asked to approve or deny the transaction.</p><p>The Comptroller maps user balances to prices (via the Price Oracle) to
risk weights (called <a rel="internal" href="comptroller.html#collateral-factor">Collateral Factors</a>) to make its determinations. Users explicitly list which assets they would like included in their risk scoring, by calling <a rel="internal" href="comptroller.html#enter-markets">Enter Markets</a> and <a rel="internal" href="comptroller.html#exit-market">Exit Market</a>.</p></section><section id="architecture"><h2 class="subheader">Architecture</h2><p>The Comptroller is implemented as an upgradeable proxy. The Unitroller proxies all logic to the Comptroller implementation, but storage values are set on the Unitroller. To call Comptroller functions, use the Comptroller ABI on the Unitroller address.</p></section><section id="enter-markets"><h2 class="subheader">Enter Markets</h2><p>Enter into a list of markets - it is not an error to enter the same market more than once. In order to supply collateral or borrow in a market, it must be entered first.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">enterMarkets</span>(<span class="elmsh7 elmsh-sol-p">address[]</span> <span class="elmsh7 elmsh-sol-p">calldata</span> <span class="elmsh7 elmsh-sol-p">cTokens</span>) <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">uint</span>[] <span class="elmsh3 elmsh-sol-k">memory</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">msg.sender</span>: The account which shall enter the given markets.</li><li><span class="inline-code">cTokens</span>: The addresses of the cToken markets to enter.</li><li><span class="inline-code">RETURN</span>: For each market, returns an error code indicating whether or not it was entered. Each is 0 on success, otherwise an <a rel="internal" href="comptroller.html#error-codes">Error code</a>.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh3 elmsh-sol-k">CToken</span>[] <span class="elmsh3 elmsh-sol-k">memory</span> cTokens <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">new</span> <span class="elmsh3 elmsh-sol-k">CToken</span>[](<span class="elmsh1 elmsh-sol-n">2</span>);
</div><div class="elmsh-line" data-elmsh-lc="3">cTokens[<span class="elmsh1 elmsh-sol-n">0</span>] <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">CErc20</span>(<span class="elmsh1 elmsh-sol-n">0x3FDA</span>...);
</div><div class="elmsh-line" data-elmsh-lc="4">cTokens[<span class="elmsh1 elmsh-sol-n">1</span>] <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">CEther</span>(<span class="elmsh1 elmsh-sol-n">0x3FDB</span>...);
</div><div class="elmsh-line" data-elmsh-lc="5"><span class="elmsh4 elmsh-sol-dk">uint</span>[] <span class="elmsh3 elmsh-sol-k">memory</span> errors <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">enterMarkets</span>(cTokens);</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> cTokens <span class="elmsh3 elmsh-js-k">=</span> [CErc20.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0x3FDA</span>...), CEther.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0x3FDB</span>...)];
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">const</span> errors <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">enterMarkets</span>(cTokens).<span class="elmsh5 elmsh-js-fe">send</span>({from<span class="elmsh3 elmsh-js-k">:</span> ...});</div></code></pre></section><section id="exit-market"><h2 class="subheader">Exit Market</h2><p>Exit a market - it is not an error to exit a market which is not currently entered. Exited markets will not count towards account liquidity calculations.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">exitMarket</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">cToken</span>) <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">uint</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">msg.sender</span>: The account which shall exit the given market.</li><li><span class="inline-code">cTokens</span>: The addresses of the cToken market to exit.</li><li><span class="inline-code">RETURN</span>: 0 on success, otherwise an <a rel="internal" href="comptroller.html#error-codes">Error code</a>.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">uint</span> error <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">exitMarket</span>(<span class="elmsh3 elmsh-sol-k">CToken</span>(<span class="elmsh1 elmsh-sol-n">0x3FDA</span>...));</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> errors <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">exitMarket</span>(CEther.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0x3FDB</span>...)).<span class="elmsh5 elmsh-js-fe">send</span>({from<span class="elmsh3 elmsh-js-k">:</span> ...});</div></code></pre></section><section id="get-assets-in"><h2 class="subheader">Get Assets In</h2><p>Get the list of markets an account is currently entered into. In order to supply collateral or borrow in a market, it must be entered first. Entered markets count towards <a rel="internal" href="comptroller.html#account-liquidity">account liquidity</a> calculations.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">getAssetsIn</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">account</span>) view <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">address</span>[] <span class="elmsh3 elmsh-sol-k">memory</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">account</span>: The account whose list of entered markets shall be queried.</li><li><span class="inline-code">RETURN</span>: The address of each market which is currently entered into.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">address</span>[] <span class="elmsh3 elmsh-sol-k">memory</span> markets <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">getAssetsIn</span>(<span class="elmsh1 elmsh-sol-n">0xMyAccount</span>);</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> markets <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">getAssetsIn</span>(cTokens).<span class="elmsh5 elmsh-js-fe">call</span>();</div></code></pre></section><section id="collateral-factor"><h2 class="subheader">Collateral Factor</h2><p>A cToken's collateral factor can range from 0-90%, and represents the proportionate increase in liquidity (borrow limit) that an account receives by minting the cToken.</p><p>Generally, large or liquid assets have high collateral factors, while small or illiquid assets have low collateral factors. If an asset has a 0% collateral factor, it can't be used as collateral (or seized in liquidation), though it can still be borrowed.</p><p class="notice"><p>Collateral factors can be increased (or decreased) through Compound Governance, as market conditions change.</p></p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">markets</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">cTokenAddress</span>) view <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">bool</span>, <span class="elmsh4 elmsh-sol-dk">uint</span>, <span class="elmsh4 elmsh-sol-dk">bool</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">cTokenAddress</span>: The address of the cToken to check if listed and get the collateral factor for.</li><li><span class="inline-code">RETURN</span>: Tuple of values (isListed, collateralFactorMantissa, isComped); isListed represents whether the comptroller recognizes this cToken; collateralFactorMantissa, scaled by 1e18, is multiplied by a supply balance to determine how much value can be borrowed. The isComped boolean indicates whether or not suppliers and borrowers are distributed COMP tokens.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2">(<span class="elmsh4 elmsh-sol-dk">bool</span> isListed, <span class="elmsh4 elmsh-sol-dk">uint</span> collateralFactorMantissa, <span class="elmsh4 elmsh-sol-dk">bool</span> isComped) <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">markets</span>(<span class="elmsh1 elmsh-sol-n">0x3FDA</span>...);</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> result <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">markets</span>(<span class="elmsh1 elmsh-js-n">0x3FDA</span>...).<span class="elmsh5 elmsh-js-fe">call</span>();
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">const</span> {<span class="elmsh1 elmsh-js-n">0</span><span class="elmsh3 elmsh-js-k">:</span> isListed, <span class="elmsh1 elmsh-js-n">1</span><span class="elmsh3 elmsh-js-k">:</span> collateralFactorMantissa, <span class="elmsh1 elmsh-js-n">2</span><span class="elmsh3 elmsh-js-k">:</span> isComped} <span class="elmsh3 elmsh-js-k">=</span> result;</div></code></pre></section><section id="account-liquidity"><h2 class="subheader">Get Account Liquidity</h2><p>Account Liquidity represents the USD value borrowable by a user, before it reaches liquidation. Users with a shortfall (negative liquidity) are subject to liquidation, and can’t withdraw or borrow assets until Account Liquidity is positive again.</p><p>For each market the user has <a rel="internal" href="comptroller.html#enter-markets">entered</a> into, their supplied balance is multiplied by the market’s <a rel="internal" href="comptroller.html#collateral-factor">collateral factor</a>, and summed; borrow balances are then subtracted, to equal Account Liquidity. Borrowing an asset reduces Account Liquidity for each USD borrowed; withdrawing an asset reduces Account Liquidity by the asset’s collateral factor times each USD withdrawn.</p><p>Because the Compound Protocol exclusively uses unsigned integers, Account Liquidity returns either a surplus or shortfall.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">getAccountLiquidity</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">account</span>) view <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">uint</span>, <span class="elmsh4 elmsh-sol-dk">uint</span>, <span class="elmsh4 elmsh-sol-dk">uint</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">account</span>: The account whose liquidity shall be calculated.</li><li><span class="inline-code">RETURN</span>: Tuple of values (error, liquidity, shortfall). The error shall be 0 on success, otherwise an <a rel="internal" href="comptroller.html#error-codes">error code</a>. A non-zero liquidity value indicates the account has available <a rel="internal" href="comptroller.html#account-liquidity">account liquidity</a>. A non-zero shortfall value indicates the account is currently below his/her collateral requirement and is subject to liquidation. At most one of liquidity or shortfall shall be non-zero.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2">(<span class="elmsh4 elmsh-sol-dk">uint</span> error, <span class="elmsh4 elmsh-sol-dk">uint</span> liquidity, <span class="elmsh4 elmsh-sol-dk">uint</span> shortfall) <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">getAccountLiquidity</span>(msg.caller);
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh3 elmsh-sol-k">require</span>(error <span class="elmsh3 elmsh-sol-k">==</span> <span class="elmsh1 elmsh-sol-n">0</span>, <span class="elmsh2 elmsh-sol-s">"join the Discord"</span>);
</div><div class="elmsh-line" data-elmsh-lc="4"><span class="elmsh3 elmsh-sol-k">require</span>(shortfall <span class="elmsh3 elmsh-sol-k">==</span> <span class="elmsh1 elmsh-sol-n">0</span>, <span class="elmsh2 elmsh-sol-s">"account underwater"</span>);
</div><div class="elmsh-line" data-elmsh-lc="5"><span class="elmsh3 elmsh-sol-k">require</span>(liquidity <span class="elmsh3 elmsh-sol-k">&gt;</span> <span class="elmsh1 elmsh-sol-n">0</span>, <span class="elmsh2 elmsh-sol-s">"account has excess collateral"</span>);</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> result <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">getAccountLiquidity</span>(<span class="elmsh1 elmsh-js-n">0xBorrower</span>).<span class="elmsh5 elmsh-js-fe">call</span>();
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">const</span> {<span class="elmsh1 elmsh-js-n">0</span><span class="elmsh3 elmsh-js-k">:</span> error, <span class="elmsh1 elmsh-js-n">1</span><span class="elmsh3 elmsh-js-k">:</span> liquidity, <span class="elmsh1 elmsh-js-n">2</span><span class="elmsh3 elmsh-js-k">:</span> shortfall} <span class="elmsh3 elmsh-js-k">=</span> result;</div></code></pre></section><section id="close-factor"><h2 class="subheader">Close Factor</h2><p>The percent, ranging from 0% to 100%, of a liquidatable account's borrow that can be repaid in a single liquidate transaction. If a user has multiple borrowed assets, the closeFactor applies to any single borrowed asset, not the aggregated value of a user’s outstanding borrowing.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">closeFactorMantissa</span>() view <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">uint</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">RETURN</span>: The closeFactor, scaled by 1e18, is multiplied by an outstanding borrow balance to determine how much could be closed.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">uint</span> closeFactor <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">closeFactorMantissa</span>();</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> closeFactor <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">closeFactoreMantissa</span>().<span class="elmsh5 elmsh-js-fe">call</span>();</div></code></pre></section><section id="liquidation-incentive"><h2 class="subheader">Liquidation Incentive</h2><p>The additional collateral given to liquidators as an incentive to perform liquidation of underwater accounts. For example, if the liquidation incentive is 1.1, liquidators receive an extra 10% of the borrowers collateral for every unit they close.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">liquidationIncentiveMantissa</span>() view <span class="elmsh5 elmsh-sol-fe">returns</span> (<span class="elmsh4 elmsh-sol-dk">uint</span>)</div></code></pre><div class="ul-container"><ul><li><span class="inline-code">RETURN</span>: The liquidationIncentive, scaled by 1e18, is multiplied by the closed borrow amount from the liquidator to determine how much collateral can be seized.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">uint</span> closeFactor <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">liquidationIncentiveMantissa</span>();</div></code></pre><h4>Web3 1.0</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> troll <span class="elmsh3 elmsh-js-k">=</span> Comptroller.<span class="elmsh5 elmsh-js-fe">at</span>(<span class="elmsh1 elmsh-js-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> closeFactor <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> troll.methods.<span class="elmsh5 elmsh-js-fe">liquidationIncentiveMantissa</span>().<span class="elmsh5 elmsh-js-fe">call</span>();</div></code></pre></section><section id="key-events"><h2 class="subheader">Key Events</h2><table class="key-events-table"><thead><tr><th>Event</th><th>Description</th></tr></thead><tbody><tr><td><p><span class="inline-code">MarketEntered(CToken cToken, address account)</span></p></td><td><p>Emitted upon a successful <a rel="internal" href="comptroller.html#enter-markets">Enter Market</a>.</p></td></tr><tr><td><p><span class="inline-code">MarketExited(CToken cToken, address account)</span></p></td><td><p>Emitted upon a successful <a rel="internal" href="comptroller.html#exit-market">Exit Market</a>.</p></td></tr></tbody></table></section><section id="error-codes"><h2 class="subheader">Error Codes</h2><table class="errors"><thead><tr><th>Code</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><p>0</p></td><td><p><span class="inline-code">NO_ERROR</span></p></td><td><p>Not a failure.</p></td></tr><tr><td><p>1</p></td><td><p><span class="inline-code">UNAUTHORIZED</span></p></td><td><p>The sender is not authorized to perform this action.</p></td></tr><tr><td><p>2</p></td><td><p><span class="inline-code">COMPTROLLER_MISMATCH</span></p></td><td><p>Liquidation cannot be performed in markets with different comptrollers.</p></td></tr><tr><td><p>3</p></td><td><p><span class="inline-code">INSUFFICIENT_SHORTFALL</span></p></td><td><p>The account does not have sufficient shortfall to perform this action.</p></td></tr><tr><td><p>4</p></td><td><p><span class="inline-code">INSUFFICIENT_LIQUIDITY</span></p></td><td><p>The account does not have sufficient liquidity to perform this action.</p></td></tr><tr><td><p>5</p></td><td><p><span class="inline-code">INVALID_CLOSE_FACTOR</span></p></td><td><p>The close factor is not valid.</p></td></tr><tr><td><p>6</p></td><td><p><span class="inline-code">INVALID_COLLATERAL_FACTOR</span></p></td><td><p>The collateral factor is not valid.</p></td></tr><tr><td><p>7</p></td><td><p><span class="inline-code">INVALID_LIQUIDATION_INCENTIVE</span></p></td><td><p>The liquidation incentive is invalid.</p></td></tr><tr><td><p>8</p></td><td><p><span class="inline-code">MARKET_NOT_ENTERED</span></p></td><td><p>The market has not been entered by the account.</p></td></tr><tr><td><p>9</p></td><td><p><span class="inline-code">MARKET_NOT_LISTED</span></p></td><td><p>The market is not currently listed by the comptroller.</p></td></tr><tr><td><p>10</p></td><td><p><span class="inline-code">MARKET_ALREADY_LISTED</span></p></td><td><p>An admin tried to list the same market more than once.</p></td></tr><tr><td><p>11</p></td><td><p><span class="inline-code">MATH_ERROR</span></p></td><td><p>A math calculation error occurred.</p></td></tr><tr><td><p>12</p></td><td><p><span class="inline-code">NONZERO_BORROW_BALANCE</span></p></td><td><p>The action cannot be performed since the account carries a borrow balance.</p></td></tr><tr><td><p>13</p></td><td><p><span class="inline-code">PRICE_ERROR</span></p></td><td><p>The comptroller could not obtain a required price of an asset.</p></td></tr><tr><td><p>14</p></td><td><p><span class="inline-code">REJECTION</span></p></td><td><p>The comptroller rejects the action requested by the market.</p></td></tr><tr><td><p>15</p></td><td><p><span class="inline-code">SNAPSHOT_ERROR</span></p></td><td><p>The comptroller could not get the account borrows and exchange rate from the market.</p></td></tr><tr><td><p>16</p></td><td><p><span class="inline-code">TOO_MANY_ASSETS</span></p></td><td><p>Attempted to enter more markets than are currently supported.</p></td></tr><tr><td><p>17</p></td><td><p><span class="inline-code">TOO_MUCH_REPAY</span></p></td><td><p>Attempted to repay more than is allowed by the protocol.</p></td></tr></tbody></table><h2 class="subheader">Failure Info</h2><table class="failure-infos"><thead><tr><th>Code</th><th>Name</th></tr></thead><tbody><tr><td><p>0</p></td><td><p><span class="inline-code">ACCEPT_ADMIN_PENDING_ADMIN_CHECK</span></p></td></tr><tr><td><p>1</p></td><td><p><span class="inline-code">ACCEPT_PENDING_IMPLEMENTATION_ADDRESS_CHECK</span></p></td></tr><tr><td><p>2</p></td><td><p><span class="inline-code">EXIT_MARKET_BALANCE_OWED</span></p></td></tr><tr><td><p>3</p></td><td><p><span class="inline-code">EXIT_MARKET_REJECTION</span></p></td></tr><tr><td><p>4</p></td><td><p><span class="inline-code">SET_CLOSE_FACTOR_OWNER_CHECK</span></p></td></tr><tr><td><p>5</p></td><td><p><span class="inline-code">SET_CLOSE_FACTOR_VALIDATION</span></p></td></tr><tr><td><p>6</p></td><td><p><span class="inline-code">SET_COLLATERAL_FACTOR_OWNER_CHECK</span></p></td></tr><tr><td><p>7</p></td><td><p><span class="inline-code">SET_COLLATERAL_FACTOR_NO_EXISTS</span></p></td></tr><tr><td><p>8</p></td><td><p><span class="inline-code">SET_COLLATERAL_FACTOR_VALIDATION</span></p></td></tr><tr><td><p>9</p></td><td><p><span class="inline-code">SET_COLLATERAL_FACTOR_WITHOUT_PRICE</span></p></td></tr><tr><td><p>10</p></td><td><p><span class="inline-code">SET_IMPLEMENTATION_OWNER_CHECK</span></p></td></tr><tr><td><p>11</p></td><td><p><span class="inline-code">SET_LIQUIDATION_INCENTIVE_OWNER_CHECK</span></p></td></tr><tr><td><p>12</p></td><td><p><span class="inline-code">SET_LIQUIDATION_INCENTIVE_VALIDATION</span></p></td></tr><tr><td><p>13</p></td><td><p><span class="inline-code">SET_MAX_ASSETS_OWNER_CHECK</span></p></td></tr><tr><td><p>14</p></td><td><p><span class="inline-code">SET_PENDING_ADMIN_OWNER_CHECK</span></p></td></tr><tr><td><p>15</p></td><td><p><span class="inline-code">SET_PENDING_IMPLEMENTATION_OWNER_CHECK</span></p></td></tr><tr><td><p>16</p></td><td><p><span class="inline-code">SET_PRICE_ORACLE_OWNER_CHECK</span></p></td></tr><tr><td><p>17</p></td><td><p><span class="inline-code">SUPPORT_MARKET_EXISTS</span></p></td></tr><tr><td><p>18</p></td><td><p><span class="inline-code">SUPPORT_MARKET_OWNER_CHECK</span></p></td></tr></tbody></table></section><section id="refresh-comp-speeds"><h2 class="subheader">COMP Distribution Speeds</h2><h3>COMP Speed</h3><p>The “COMP speed” unique to each market is an unsigned integer that specifies the amount of COMP that is distributed, per block, to suppliers and borrowers in each market. As market conditions change, COMP speeds are updated to ensure COMP is distributed proportional to the utility of each market. Any user can call the Comptroller’s <span class="inline-code">refreshCompSpeeds</span> method at any time in order to update market COMP speeds.</p><p>The following is the formula for calculating the rate that COMP is distributed to each supported market.</p><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1">utility <span class="elmsh3 elmsh-sol-k">=</span> cTokenTotalBorrows <span class="elmsh3 elmsh-sol-k">*</span> assetPrice
</div><div class="elmsh-line" data-elmsh-lc="2">
</div><div class="elmsh-line" data-elmsh-lc="3">utilityFraction <span class="elmsh3 elmsh-sol-k">=</span> utility <span class="elmsh3 elmsh-sol-k">/</span> sumOfAllCOMPedMarketUtilities
</div><div class="elmsh-line" data-elmsh-lc="4">
</div><div class="elmsh-line" data-elmsh-lc="5">marketCompSpeed <span class="elmsh3 elmsh-sol-k">=</span> compRate <span class="elmsh3 elmsh-sol-k">*</span> utilityFraction</div></code></pre><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">refreshCompSpeeds</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">account</span>) <span class="elmsh3 elmsh-sol-k">public</span></div></code></pre><div class="ul-container"><ul><li><span class="inline-code">RETURN</span>: None</li><li><span class="inline-code">events</span>: <span class="inline-code">CompSpeedUpdated</span> - An event is emitted for each cToken with the address of the cToken and the new COMP distribution speed per block.</li></ul></div><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2">troll.<span class="elmsh5 elmsh-sol-fe">refreshCompSpeeds</span>();</div></code></pre><h4>Web3 1.2.6</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> comptroller <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">new</span> web3.eth.<span class="elmsh5 elmsh-js-fe">Contract</span>(comptrollerAbi, comptrollerAddress);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh3 elmsh-js-k">await</span> comptroller.methods.<span class="elmsh5 elmsh-js-fe">refreshCompSpeeds</span>().<span class="elmsh5 elmsh-js-fe">send</span>({ from<span class="elmsh3 elmsh-js-k">:</span> sender });</div></code></pre><h3>COMP Distributed Per Block (All Markets)</h3><p>The Comptroller Storage contract’s <span class="inline-code">compRate</span> is an unsigned integer that indicates the rate at which the protocol distributes COMP to markets’ suppliers or borrowers, every Ethereum block. The value is the amount of COMP (in wei), per block, allocated for the markets. Note that not every market has COMP distributed to its participants (see Market Metadata).</p><p>The compRate indicates how much COMP goes to the suppliers or borrowers, so doubling this number shows how much COMP goes to all suppliers and borrowers combined. The code examples implement reading the amount of COMP distributed, per Ethereum block, to all markets.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-sol-dk">uint</span> <span class="elmsh3 elmsh-sol-k">public</span> compRate;</div></code></pre><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2">
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh-comm">// COMP issued per block to suppliers OR borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="4"><span class="elmsh4 elmsh-sol-dk">uint</span> compRate <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">compRate</span>();
</div><div class="elmsh-line" data-elmsh-lc="5">
</div><div class="elmsh-line" data-elmsh-lc="6"><span class="elmsh-comm">// Approximate COMP issued per day to suppliers OR borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="7"><span class="elmsh4 elmsh-sol-dk">uint</span> compRatePerDay <span class="elmsh3 elmsh-sol-k">=</span> compRate <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">4</span> <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">60</span> <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">24</span>;
</div><div class="elmsh-line" data-elmsh-lc="8">
</div><div class="elmsh-line" data-elmsh-lc="9"><span class="elmsh-comm">// Approximate COMP issued per day to suppliers AND borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="10"><span class="elmsh4 elmsh-sol-dk">uint</span> compRatePerDayTotal <span class="elmsh3 elmsh-sol-k">=</span> compRatePerDay <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">2</span>;</div></code></pre><h4>Web3 1.2.6</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> comptroller <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">new</span> web3.eth.<span class="elmsh5 elmsh-js-fe">Contract</span>(comptrollerAbi, comptrollerAddress);
</div><div class="elmsh-line" data-elmsh-lc="2">
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">let</span> compRate <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> comptroller.methods.<span class="elmsh5 elmsh-js-fe">compRate</span>().<span class="elmsh5 elmsh-js-fe">call</span>();
</div><div class="elmsh-line" data-elmsh-lc="4">compRate <span class="elmsh3 elmsh-js-k">=</span> compRate <span class="elmsh3 elmsh-js-k">/</span> <span class="elmsh1 elmsh-js-n">1e18</span>;
</div><div class="elmsh-line" data-elmsh-lc="5">
</div><div class="elmsh-line" data-elmsh-lc="6"><span class="elmsh-comm">// COMP issued to suppliers OR borrowers</span>
</div><div class="elmsh-line" data-elmsh-lc="7"><span class="elmsh4 elmsh-js-dk">const</span> compRatePerDay <span class="elmsh3 elmsh-js-k">=</span> compRate <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">4</span> <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">60</span> <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">24</span>;
</div><div class="elmsh-line" data-elmsh-lc="8">
</div><div class="elmsh-line" data-elmsh-lc="9"><span class="elmsh-comm">// COMP issued to suppliers AND borrowers</span>
</div><div class="elmsh-line" data-elmsh-lc="10"><span class="elmsh4 elmsh-js-dk">const</span> compRatePerDayTotal <span class="elmsh3 elmsh-js-k">=</span> compRatePerDay <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">2</span>;</div></code></pre><h3>COMP Distributed Per Block (Single Market)</h3><p>The Comptroller Storage contract has a mapping called <span class="inline-code">compSpeeds</span>. It maps cToken addresses to an integer of each market’s COMP distribution per Ethereum block. The integer indicates the rate at which the protocol distributes COMP to markets’ suppliers or borrowers. The value is the amount of COMP (in wei), per block, allocated for the market. Note that not every market has COMP distributed to its participants (see Market Metadata).</p><p>The speed indicates how much COMP goes to the suppliers or the borrowers, so doubling this number shows how much COMP goes to market suppliers and borrowers combined. The code examples implement reading the amount of COMP distributed, per Ethereum block, to a single market.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh5 elmsh-sol-fe">mapping</span>(<span class="elmsh4 elmsh-sol-dk">address</span> <span class="elmsh3 elmsh-sol-k">=&gt;</span> <span class="elmsh4 elmsh-sol-dk">uint</span>) <span class="elmsh3 elmsh-sol-k">public</span> compSpeeds;</div></code></pre><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0x123</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">address</span> cToken <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh1 elmsh-sol-n">0xabc</span>...;
</div><div class="elmsh-line" data-elmsh-lc="3">
</div><div class="elmsh-line" data-elmsh-lc="4"><span class="elmsh-comm">// COMP issued per block to suppliers OR borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="5"><span class="elmsh4 elmsh-sol-dk">uint</span> compSpeed <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">compSpeeds</span>(cToken);
</div><div class="elmsh-line" data-elmsh-lc="6">
</div><div class="elmsh-line" data-elmsh-lc="7"><span class="elmsh-comm">// Approximate COMP issued per day to suppliers OR borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="8"><span class="elmsh4 elmsh-sol-dk">uint</span> compSpeedPerDay <span class="elmsh3 elmsh-sol-k">=</span> compSpeed <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">4</span> <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">60</span> <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">24</span>;
</div><div class="elmsh-line" data-elmsh-lc="9">
</div><div class="elmsh-line" data-elmsh-lc="10"><span class="elmsh-comm">// Approximate COMP issued per day to suppliers AND borrowers * (1 * 10 ^ 18)</span>
</div><div class="elmsh-line" data-elmsh-lc="11"><span class="elmsh4 elmsh-sol-dk">uint</span> compSpeedPerDayTotal <span class="elmsh3 elmsh-sol-k">=</span> compSpeedPerDay <span class="elmsh3 elmsh-sol-k">*</span> <span class="elmsh1 elmsh-sol-n">2</span>;</div></code></pre><h4>Web3 1.2.6</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> cTokenAddress <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh2 elmsh-js-s">'0xabc...'</span>;
</div><div class="elmsh-line" data-elmsh-lc="2">
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">const</span> comptroller <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">new</span> web3.eth.<span class="elmsh5 elmsh-js-fe">Contract</span>(comptrollerAbi, comptrollerAddress);
</div><div class="elmsh-line" data-elmsh-lc="4">
</div><div class="elmsh-line" data-elmsh-lc="5"><span class="elmsh4 elmsh-js-dk">let</span> compSpeed <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> comptroller.methods.<span class="elmsh5 elmsh-js-fe">compSpeeds</span>(cTokenAddress).<span class="elmsh5 elmsh-js-fe">call</span>();
</div><div class="elmsh-line" data-elmsh-lc="6">compSpeed <span class="elmsh3 elmsh-js-k">=</span> compSpeed <span class="elmsh3 elmsh-js-k">/</span> <span class="elmsh1 elmsh-js-n">1e18</span>;
</div><div class="elmsh-line" data-elmsh-lc="7">
</div><div class="elmsh-line" data-elmsh-lc="8"><span class="elmsh-comm">// COMP issued to suppliers OR borrowers</span>
</div><div class="elmsh-line" data-elmsh-lc="9"><span class="elmsh4 elmsh-js-dk">const</span> compSpeedPerDay <span class="elmsh3 elmsh-js-k">=</span> compSpeed <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">4</span> <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">60</span> <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">24</span>;
</div><div class="elmsh-line" data-elmsh-lc="10">
</div><div class="elmsh-line" data-elmsh-lc="11"><span class="elmsh-comm">// COMP issued to suppliers AND borrowers</span>
</div><div class="elmsh-line" data-elmsh-lc="12"><span class="elmsh4 elmsh-js-dk">const</span> compSpeedPerDayTotal <span class="elmsh3 elmsh-js-k">=</span> compSpeedPerDay <span class="elmsh3 elmsh-js-k">*</span> <span class="elmsh1 elmsh-js-n">2</span>;</div></code></pre></section><section id="claim-comp"><h2 class="subheader">Claim COMP</h2><p>Every Compound user accrues COMP for each block they are supplying to or borrowing from the protocol. The protocol automatically transfers accrued COMP to a user’s address when the total amount of COMP accrued to that address (in a market) is greater than the <span class="inline-code">claimCompThreshold</span>, and the address executes any of the <span class="inline-code">mint</span>, <span class="inline-code">borrow</span>, <span class="inline-code">transfer</span>, <span class="inline-code">liquidateBorrow</span>, <span class="inline-code">repayBorrow</span>, or <span class="inline-code">redeem</span> functions on that market. Separately, users may call the <span class="inline-code">claimComp</span> method on any cToken contract at any time for finer grained control over which markets to claim from.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh-comm">// Claim all the COMP accrued by holder in all markets</span>
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">claimComp</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">holder</span>) <span class="elmsh3 elmsh-sol-k">public</span>
</div><div class="elmsh-line" data-elmsh-lc="3">
</div><div class="elmsh-line" data-elmsh-lc="4"><span class="elmsh-comm">// Claim all the COMP accrued by holder in specific markets</span>
</div><div class="elmsh-line" data-elmsh-lc="5"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">claimComp</span>(<span class="elmsh7 elmsh-sol-p">address</span> <span class="elmsh7 elmsh-sol-p">holder</span>, <span class="elmsh7 elmsh-sol-p">CToken[]</span> <span class="elmsh7 elmsh-sol-p">memory</span> <span class="elmsh7 elmsh-sol-p">cTokens</span>) <span class="elmsh3 elmsh-sol-k">public</span>
</div><div class="elmsh-line" data-elmsh-lc="6">
</div><div class="elmsh-line" data-elmsh-lc="7"><span class="elmsh-comm">// Claim all the COMP accrued by specific holders in specific markets for their supplies and/or borrows</span>
</div><div class="elmsh-line" data-elmsh-lc="8"><span class="elmsh4 elmsh-sol-dk">function</span> <span class="elmsh5 elmsh-sol-f">claimComp</span>(<span class="elmsh7 elmsh-sol-p">address[]</span> <span class="elmsh7 elmsh-sol-p">memory</span> <span class="elmsh7 elmsh-sol-p">holders</span>, <span class="elmsh7 elmsh-sol-p">CToken[]</span> <span class="elmsh7 elmsh-sol-p">memory</span> <span class="elmsh7 elmsh-sol-p">cTokens</span>, <span class="elmsh7 elmsh-sol-p">bool</span> <span class="elmsh7 elmsh-sol-p">borrowers</span>, <span class="elmsh7 elmsh-sol-p">bool</span> <span class="elmsh7 elmsh-sol-p">suppliers</span>) <span class="elmsh3 elmsh-sol-k">public</span></div></code></pre><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2">troll.<span class="elmsh5 elmsh-sol-fe">claimComp</span>(<span class="elmsh1 elmsh-sol-n">0x1234</span>...);</div></code></pre><h4>Web3 1.2.6</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> comptroller <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">new</span> web3.eth.<span class="elmsh5 elmsh-js-fe">Contract</span>(comptrollerAbi, comptrollerAddress);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh3 elmsh-js-k">await</span> comptroller.methods.<span class="elmsh5 elmsh-js-fe">claimComp</span>(<span class="elmsh2 elmsh-js-s">"0x1234..."</span>).<span class="elmsh5 elmsh-js-fe">send</span>({ from<span class="elmsh3 elmsh-js-k">:</span> sender });</div></code></pre></section><section id="market-metadata"><h2 class="subheader">Market Metadata</h2><p>The Comptroller contract has an array called <span class="inline-code">allMarkets</span> that contains the addresses of each cToken contract. Each address in the <span class="inline-code">allMarkets</span> array can be used to fetch a metadata struct in the Comptroller’s markets constant. See the <a target="_blank" rel="external" href="https://github.com/compound-finance/compound-protocol/blob/master/contracts/ComptrollerStorage.sol">Comptroller Storage contract</a> for the Market struct definition.</p><h4>Comptroller</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">CToken</span>[] <span class="elmsh3 elmsh-sol-k">public</span> allMarkets;</div></code></pre><h4>Solidity</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh3 elmsh-sol-k">Comptroller</span> troll <span class="elmsh3 elmsh-sol-k">=</span> <span class="elmsh3 elmsh-sol-k">Comptroller</span>(<span class="elmsh1 elmsh-sol-n">0xABCD</span>...);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh3 elmsh-sol-k">CToken</span> cTokens[] <span class="elmsh3 elmsh-sol-k">=</span> troll.<span class="elmsh5 elmsh-sol-fe">allMarkets</span>();</div></code></pre><h4>Web3 1.2.6</h4><pre class="elmsh"><code><div class="elmsh-line" data-elmsh-lc="1"><span class="elmsh4 elmsh-js-dk">const</span> comptroller <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">new</span> web3.eth.<span class="elmsh5 elmsh-js-fe">Contract</span>(comptrollerAbi, comptrollerAddress);
</div><div class="elmsh-line" data-elmsh-lc="2"><span class="elmsh4 elmsh-js-dk">const</span> cTokens <span class="elmsh3 elmsh-js-k">=</span> <span class="elmsh3 elmsh-js-k">await</span> comptroller.methods.<span class="elmsh5 elmsh-js-fe">allMarkets</span>().<span class="elmsh5 elmsh-js-fe">call</span>();
</div><div class="elmsh-line" data-elmsh-lc="3"><span class="elmsh4 elmsh-js-dk">const</span> cToken <span class="elmsh3 elmsh-js-k">=</span> cTokens[<span class="elmsh1 elmsh-js-n">0</span>]; <span class="elmsh-comm">// address of a cToken</span></div></code></pre></section><pre></pre></div></div></div></div><footer id="footer" class="landing"><div class="container-large"><div class="row top"><div class="col-sm-2 logo mobile-hide"><a href="../index.html" class="mark"></a></div><div class="col-xs-12 logo mobile-only"><a href="../index.html" class="brand"></a></div><div class="col-sm-8 col-xs-12 row links-holder"><div class="col-sm-3 col-xs-6 links"><p>Protocol</p><a href="../markets.html">Markets</a><a href="../prices.html">Prices</a><a href="../developers.html">Developers</a><a href="../docs.html">Docs</a></div><div class="col-sm-3 col-xs-6 links"><p>Governance</p><a href="../governance.html">Overview</a><a href="../governance/comp.html">COMP</a><a href="../governance/leaderboard.html">Leaderboard</a><a rel="external" href="https://www.comp.xyz/">Forums</a></div><div class="col-sm-3 col-xs-6 links"><p>Company</p><a href="../about.html">About</a><a href="../about.html#jobs">Careers</a></div></div><div class="mobile-hide col-xs-2 text-right"><a class="dapp button" rel="external" href="../../app.compound.finance/index.html">App</a></div></div><div class="bottom"><label class="small">© 2020 Compound Labs, Inc.</label><div class="social"><a class="icn discord" target="_blank" rel="external" href="https://discord.gg/cU7vmVW"></a><a class="icn github" target="_blank" rel="external" href="https://github.com/compound-finance/compound-protocol"></a><a class="icn medium" target="_blank" rel="external" href="https://medium.com/compound-finance"></a><a class="icn twitter" target="_blank" rel="external" href="https://twitter.com/compoundfinance"></a><div class="dropdown dropdown--network"><span class="dropdown__selected dropdown__selected--dark2"><span class="dot-indicator green"></span><label class="small">Mainnet</label></span><div class="dropdown__options dropdown__options--network dropdown__selected--dark2 "></div></div></div></div></div></footer></div><script src="../static/js/runtime_landing.20510066.js"></script><script src="../static/js/vendors_dapp_landing_polyfills.e9e68e69.chunk.js"></script><script src="../static/js/vendors_dapp_landing.2efa2a68.chunk.js"></script><script src="../static/js/landing.ce21e0fb.chunk.js"></script></body>
<!-- Mirrored from compound.finance/docs/comptroller by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Nov 2020 22:06:21 GMT -->
</html>